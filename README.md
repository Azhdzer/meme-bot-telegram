# MemeBot v6.5

Небольшой Telegram-бот для скачивания медиа по ссылкам из TikTok, Instagram и YouTube (Shorts).

Бот написан на **Python 3.10+** с использованием **aiogram 3**, разбит по модулям «как в учебнике».

## Установка

1. Клонировать / скопировать проект.
2. Установить зависимости:

```bash
pip install -r requirements.txt
```

3. Создать и указать токен бота (получается у `@BotFather`):

```bash
set BOT_TOKEN=ВАШ_ТОКЕН_ТЕЛЕГРАМ_БОТА  # Windows PowerShell/cmd
```

Или прописать `BOT_TOKEN` в переменных окружения системы.

## Запуск

Из корня проекта:

```bash
python botmeme_ver2.py
```

После запуска бот начинает polling и обрабатывает команды/сообщения.

## Структура проекта

- `config.py` – общая конфигурация:
  - `API_TOKEN` – токен бота (по умолчанию берётся из `BOT_TOKEN`);
  - `url_patterns` – регулярные выражения для TikTok / YouTube / Instagram;
  - `TIKTOK_APIS` – список используемых API для скачивания TikTok.

- `bot.py` – инициализация инфраструктуры бота:
  - создаётся `bot: Bot` и `dp: Dispatcher`.

- `utils.py` – общие вспомогательные функции:
  - `download_log` – хранение логов по каждому URL;
  - `processing_tasks` – множество активных задач, чтобы не скачивать одно и то же;
  - `add_to_log` – добавление записей в лог (в память + логгер);
  - `safe_delete_message` – безопасное удаление сообщений;
  - `safe_send_message` – безопасная отправка текста без Markdown-ошибок.

- `downloaders.py` – модуль, отвечающий за скачивание медиа:
  - `download_tiktok` – загрузка видео TikTok через несколько публичных API;
  - `download_instagram` – HTML / JSON / GraphQL / oEmbed-парсинг Instagram;
  - `download_youtube` – скачивание YouTube/Shorts через `yt-dlp` с ограничением размера;
  - `download_video` – единая точка входа, выбирающая нужный загрузчик.

- `tasks.py` – фоновые задачи:
  - `process_video_task` – принимает ссылку, качает медиа, отправляет его пользователю
    и корректно обрабатывает ошибки/ограничения.

- `handlers.py` – все Telegram‑хендлеры бота:
  - `/start` – приветствие и краткая инструкция;
  - `/logs` – последние 3 URL из логов;
  - `/log <url>` – подробный лог по конкретной ссылке;
  - обработчик обычных сообщений – ищет ссылки в тексте и создаёт фоновые задачи.

- `botmeme_ver2.py` – точка входа:
  - настраивает `logging`;
  - импортирует `handlers` (регистрация хендлеров через декораторы);
  - запускает `dp.start_polling(bot)`.

## Как развивать проект

- **Новая платформа / новый парсер** – добавлять в `downloaders.py`:
  - реализовать функцию `download_<platform>()` и при необходимости расширить `download_video`.

- **Изменить поведение фоновых задач** (ограничения, ретраи, таймауты и т.д.) – править `tasks.py`.

- **Новые команды / изменения диалогов** – добавлять/менять хендлеры в `handlers.py`.

- **Изменить токен / паттерны ссылок / список API** – редактировать `config.py`.

- **Общие утилиты (логика логирования, безопасные отправки и т.п.)** – расширять `utils.py`.

Такой разбор по файлам удобно демонстрировать преподавателю: каждая ответственность в своём модуле,
код читаемый и легко расширяемый.

